name: Stainless â€” Build SDK
description: Build SDKs
branding:
  icon: book-open
  color: green
runs:
  using: node20
  main: ../dist/build.js

# All inputs are also supported in GitLab CI, input as an all-uppercase variable.
inputs:
  stainless_api_key:
    description: >-
      Stainless API key. Optional for GitHub Actions (will use OIDC authentication
      if not provided, requires 'id-token: write' permission). Required for GitLab CI.
    required: false
  org:
    description: Stainless organization name.
    required: false
  project:
    description: Stainless project name.
    required: true
  oas_path:
    description: >-
      Path to your OpenAPI spec. If omitted, and `merge_branch` is false,
      will use the existing OpenAPI spec on the Stainless branch.
    required: false
  config_path:
    description: >-
      Path to your Stainless config. If omitted, and `merge_branch` is false,
      will use the existing Stainless config on the Stainless branch.
    required: false
  commit_message:
    description: >-
      Commit message to use in the commits in the SDK repo. Use a commit
      message in the conventional commits format:
      https://www.conventionalcommits.org/en/v1.0.0/
    required: false
  guess_config:
    description: >-
      If true, update the existing Stainless config file based on the OpenAPI
      spec. Cannot be specified if `config_path` is specified.
    required: false
    default: false
  fail_on:
    description: >-
      When to fail the run based on build conclusion. Options: 'note',
      'warning', 'error', 'fatal', 'never'.
    required: false
    default: "error"
  make_comment:
    description: >-
      If true, will comment on the pull request with the build results.
    required: false
    default: "true"
  multiple_commit_messages:
    description: >-
      If true, the comment will display separate commit messages for each SDK,
      instead of using a single commit message for all SDKs.
    required: false
    default: "false"
  github_token:
    description: >-
      A GitHub token used for making comments on pull requests. Required if
      `make_comment` is true. The token must have the `pull-requests: write`
      permission. Defaults to the current workflow token.
    required: false
    default: ${{ github.token }}
  branch:
    description: Stainless branch to create the build on.
    required: false
    default: main
  merge_branch:
    description: >-
      Stainless branch to merge changes from. The OpenAPI spec and Stainless
      config from the `merge_branch` will be used to create a build on top of
      the Stainless branch.
    required: false
  base_revision:
    description: >-
      A base revision to compare this build against. Must be a config commit
      SHA. Cannot be specified if `merge_branch` is specified.
    required: false
  base_branch:
    description: >-
      Stainless branch to create the base build on. Must be specified if
      `base_revision` is specified.
    required: false
  default_branch:
    description: >-
      The branch of the repository that the `main` Stainless branch of your
      project gets its OpenAPI spec from. This is usually the default branch of
      your repository. Used to determine whether the build should be skipped.
    required: false
    default: ${{ github.event.repository.default_branch }}
  output_dir:
    description: >-
      Directory to write output files to. Defaults to the runner's temporary
      directory.
    required: false
    default: ${{ runner.temp }}
  documented_spec_path:
    description: >-
      Path to write an OpenAPI spec with SDK code samples, if configured. See
      https://app.stainless.com/docs/reference/config#open-api-config for
      more details.
    required: false
  log_level:
    description: >-
      Log verbosity level. Options: 'debug', 'info', 'warn', 'error', 'off'.
      Use 'debug' for detailed diagnostic information.
    required: false
    default: "info"

outputs:
  outcomes:
    description: >-
      JSON-stringified object of build outcomes. Keys are languages, and values
      contain the `commit` result of the build for that language. Will look
      like:

      ```
      {
        "typescript": {
          "install_url": "https://pkg.stainless.com/...",
          "commit": {
            "status": "completed",
            "completed": {
              "conclusion": "success",
              "commit": {
                "sha": "...",
                "repo": {
                  "branch": "...",
                  "name": "...",
                  "owner": "...",
                  ...
                },
              },
              ...
            }
            ...
          },
        },
        ...
      }
      ```
  base_outcomes:
    description: >-
      JSON-stringified object of base build outcomes. Present when
      `base_revision` is specified. Keys are languages, and values contain the
      `commit` result of the build for that language. Will look like:

      ```
      {
        "typescript": {
          "install_url": "https://pkg.stainless.com/...",
          "commit": {
            "status": "completed",
            "completed": {
              "conclusion": "success",
              "commit": {
                "sha": "...",
                "repo": {
                  "branch": "...",
                  "name": "...",
                  "owner": "...",
                  ...
                },
              },
              ...
            }
            ...
          },
        },
        ...
      }
      ```
  documented_spec_path:
    description: >-
      Path to an OpenAPI spec with SDK code samples. Present when `output_dir`
      is specified and `code_samples` is in your Stainless config. See
      https://app.stainless.com/docs/reference/config#open-api-config for
      more details.
